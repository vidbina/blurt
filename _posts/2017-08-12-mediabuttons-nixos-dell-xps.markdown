---
layout: post
title: Enabling Dell XPS's Mediabuttons on NixOS
description: |
  Getting the mediabuttons on the Dell 9560 (XPS) to work in NixOS by a few
  tweaks in the nixos configuration files.
date:  2017-08-12 21:12:35 +0000
type: tools
category: config
tags:
 - tools
 - autogenerated
og:
  type: article # http://ogp.me/#types
#  og:type: # 
#   - og:value: value
#     og:attr: foo
#   - og:value: value
#image: https://s3.eu-central-1.amazonaws.com/vid.bina.me/img/brexit.png
#twitter:
#  card: summary
#  image: https://s3.eu-central-1.amazonaws.com/vid.bina.me/img/brexit.png
head: mugshot
---

Inside your configuration.nix, or whichever file you import from your
configuration.nix with the purpose of containing audio-related settings, add
the following snippet:

```nixos
services.actkbd = with pkgs; {
  enable = true;
  bindings = [
    # "Mute" media key
    {
      keys = [ 113 ];
      events = [ "key" ];
      command = "${alsaUtils}/bin/amixer -q set Master toggle";
    }

    # "Lower Volume" media key
    {
      keys = [ 114 ];
      events = [ "key" "rep" ];
      command = "${alsaUtils}/bin/amixer -q set Master 1- unmute";
    }

    # "Raise Volume" media key
    {
      keys = [ 115 ];
      events = [ "key" "rep" ];
      command = "${alsaUtils}/bin/amixer -q set Master 1+ unmute";
    }
  ];
};
```

The keycodes for the snippet have been acquired by switching to a virtual
terminal and running
`showkey`. The showkey application displays the keycodes for the pressed keys
and exits after 10 seconds without input. In my case the keycodes for mute,
volume down and volume up represented the keycodes 113, 114 and 115
respectively.

> Be careful whenever you end up with keycodes 59, 60 and 61 for the mute,
volume down and volume up keys as these are actually the keycodes for the
function keys `F1`, `F2` and `F3`. If you end up with these keycodes, you may
have to press `Fn` along with the intended function key to evoke the alternate
behavior :wink:.

Since my function keys have been configured in my BIOS to behave as function
keys instead of multimedia keys, I can switch between virtual terminals by
simultaneously pressing `Ctrl`, `Alt` and any of my function keys ranging from
`F1` through `F12`.

> Note that NixOS reserves the seventh virtual terminal for the window manager
and the [eight terminal for its manual][nixos-altf8]. 


Triggering the multimedia behavior for mute, which is set
up on the `F1` key, will require me to simultaneously press `Fn` and `F1`. Note
that `Fn` indicates to the system that I intent to trigger the alternate
behavior for the given key.

> When the BIOS is configured to treat function keys as multimedia keys, one
will have to prefix the function key with the `Fn` key within the keystroke
sequence necessary to switch to the virtual terminals. Switching to virtual
terminal 1 would, in that case, require the simultaneous pressing of `Ctrl`,
`Alt`, `Fn` and `F1`. The mute button, however; would be accessible through a
simple press of just the `F1` button. It's obviously up to you to determine which configuration makes sense
for you as long as you are aware of the differences in use that this may
entail.

[dell-bios-fn]: https://www.howtogeek.com/235351/how-to-choose-whether-your-function-keys-are-f1-f12-keys-or-special-keys/
[nixos-altf8]: https://nixos.org/nixos/manual/#sec-installation
